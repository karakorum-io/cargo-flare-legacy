<div style="display: none"><div id="maildiv">	<table cellspacing="2" cellpadding="0" border="0">		<tr>			<td>@mail_to@</td>		</tr>		<tr>			<td>@mail_subject@</td>		</tr>		<tr>			<td>@mail_body@</td>		</tr>		<tr>			<td colspan="2">&nbsp;</td>		</tr>		<tr>			<td>Attachment:&nbsp;</td>			<td id="mail_file_name" style="font-weight: bold; color: #0052a4; ">				&nbsp;			</td>		</tr>	</table></div></div><script type="text/javascript">$("#maildiv").dialog({		modal: true,		width: 400,		height: 310,		title: "Email message with that document attached.",		hide: 'fade',		resizable: false,		draggable: false,		autoOpen: false,		buttons: {			"Submit": function () {				$.ajax({					url: BASE_PATH + 'application/ajax/send_document.php',					data: {						action: "entity",						file_id: mail_file_id,						mail_to: $('#mail_to').val(),						mail_subject: $('#mail_subject').val(),						mail_body: $('#mail_body').val()					},					type: 'POST',					dataType: 'json',					beforeSend: function () {						if (!validateMailForm()) {							return false;						} else {							// // $("body").nimbleLoader("show");						}					},					success: function (response) {						// $("body").nimbleLoader("hide");						if (response.success == true) {							$("#maildiv").dialog("close");							clearMailForm();						}						alert(response.message);					},					complete: function () {						// $("body").nimbleLoader("hide");					}				});			},			"Cancel": function () {				$(this).dialog("close");			}		}	});	var busy = false;	function updateInternalNotes(data) {		var rows = "";		for (i in data) {			rows += '<tr class="grid-body"><td>'+data[i].created+'</td><td id="note_'+data[i].id+'_text">'+decodeURIComponent(data[i].text)+'</td><td>';			rows += '<a href="mailto:'+data[i].email+'">'+data[i].email+'</a></td><td style="white-space: nowrap;">';			rows += '<img src="<?= SITE_IN ?>images/icons/edit.png" alt="Edit" title="Edit" width="16" height="16" class="action-icon edit-note" onclick="editInternalNote('+data[i].id+')"/>';			rows += '<img src="<?= SITE_IN ?>images/icons/delete.png" alt="Delete" title="Delete" width="16" height="16" class="action-icon delete-note" onclick="delInternalNote('+data[i].id+')"/>';			rows += '</td></tr>';		}		$("#internal_notes_table tbody").html(rows);	}	function addInternalNote() {		if (busy) return;		busy = true;		var text = $.trim($("#internal_note").val());		if (text == "") return;		$("#internal_note").val("");		$.ajax({			type: "POST",			url: "<?= SITE_IN ?>application/ajax/notes.php",			dataType: "json",			data: {				action: 'add',				text: encodeURIComponent(text),				entity_id: <?= $this->entity->id ?>,				notes_type: <?= Note::TYPE_INTERNAL ?>			},			success: function(result) {				if (result.success == true) {					updateInternalNotes(result.data);				} else {					$("#internal_note").val(text);					alert("Can't save note. Try again later, please");				}				busy = false;			},			error: function(result) {				$("#internal_note").val(text);				alert("Can't save note. Try again later, please");				busy = false;			}		});	}	function delInternalNote(id) {		if (confirm("Are you sure whant to delete this note?")) {			if (busy) return;			busy = true;			$.ajax({				type: "POST",				url: "<?= SITE_IN ?>application/ajax/notes.php",				dataType: "json",				data: {					action: 'del',					id: id,					entity_id: <?= $this->entity->id ?>,					notes_type: <?= Note::TYPE_INTERNAL ?>				},				success: function(result) {					if (result.success == true) {						updateInternalNotes(result.data);					} else {						alert("Can't delete note. Try again later, please");					}					busy = false;				},				error: function(result) {					alert("Can't delete note. Try again later, please");					busy = false;				}			});		}	}	function editInternalNote(id) {		var text = $.trim($("#note_"+id+"_text").text());		$("#note_edit_form textarea").val(text);		$("#note_edit_form").dialog({			width: 400,			modal: true,			title: "Edit Internal Note",			resizable: false,			buttons: [{				text: "Save",				click: function() {					if ($("#note_edit_form textarea").val() == text) {						$(this).dialog("close");					} else {						if (busy) return;						busy = true;						text = encodeURIComponent($.trim($("#note_edit_form textarea").val()));						$.ajax({							type: "POST",							url: "<?= SITE_IN ?>application/ajax/notes.php",							dataType: "json",							data: {								action: 'update',								id: id,								text: text,								entity_id: <?= $this->entity->id ?>,								notes_type: <?= Note::TYPE_INTERNAL ?>							},							success: function(result) {								if (result.success == true) {									updateInternalNotes(result.data);									$("#note_edit_form").dialog("close");								} else {									alert("Can't save note. Try again later, please");								}								busy = false;							},							error: function(result) {								alert("Can't save note. Try again later, please");								busy = false;							}						});					}				}			},{				text: "Cancel",				click: function() {					$(this).dialog("close");					busy = false;				}			}]		}).dialog("open");	}</script><div id="note_edit_form" style="display:none;">	<textarea style="width: 95%;height:100px;" class="form-box-textarea" name="note_text"></textarea></div><div style="padding-top:15px;"><?php include('quote_menu.php');  ?></div><br/><h3>Quote #<?= $this->entity->getNumber() ?> Detail</h3><div class="quote-info" style="width: 445px;"><?php	$assigned = $this->entity->getAssigned();	$shipper = $this->entity->getShipper();	$origin = $this->entity->getOrigin();	$destination = $this->entity->getDestination();	$vehicles = $this->entity->getVehicles();?>	<p class="block-title">Quote Information</p>	<div>		<strong>Assigned to: </strong><?= $assigned->contactname ?><br/>		<table cellspacing="0" cellpadding="0" border="0" width="100%">			<tr>				<td style="vertical-align:top;">					<strong>Shipper: </strong><br/>					<?= $shipper->fname ?> <?= $shipper->lname ?><br/>					Phone: <?= $shipper->phone1; ?><br/>                    <? if ($shipper->email !=""){?>					<a href="mailto:<?= $shipper->email ?>"><?= $shipper->email ?></a>                    <? } ?>				</td>				<td style="vertical-align:top;">					<strong>Origin: </strong><?= $origin->getFormatted() ?><br/>					<strong>Destination: </strong><?= $destination->getFormatted() ?><br/>					<strong>Vehicle: </strong><br/>					<?php if (count($vehicles) == 0) : ?>					<?php elseif (count($vehicles) == 1) : ?>						<?php $vehicle = $vehicles[0]; ?>						<?= $vehicle->year ?> <?= $vehicle->make.' '.$vehicle->model ?><br/>						<?= $vehicle->type ?>&nbsp;<?=imageLink($vehicle->year." ".$vehicle->make." ".$vehicle->model." ".$vehicle->type)?><br/>					<?php else : ?>						<span class="like-link multi-vehicles">Multiple Vehicles</span>						<div class="vehicles-info">						<?php foreach($vehicles as $vehicle) : ?>							<p><?= $vehicle->make ?> <?= $vehicle->model ?></p>							<?= $vehicle->year ?> <?= $vehicle->type ?>&nbsp;<?=imageLink($vehicle->year." ".$vehicle->make." ".$vehicle->model." ".$vehicle->type)?>							<br/>						<?php endforeach; ?>						</div>						<br/>					<?php endif; ?>				</td>			</tr>		</table>	</div></div><div class="quote-info" style="width: 472px; float: right; margin-bottom: 10px;">    <p class="block-title">Payment Terms</p>    <div>        <img style="vertical-align: middle" src="<?= SITE_IN ?>images/icons/dollar.png" alt="Total Tariff" title="Total Tariff" width="16" height="16"/> <strong>Total Tariff amount: </strong><?= $this->entity->getTotalTariff() ?><br />        <img style="vertical-align: middle" src="<?= SITE_IN ?>images/icons/truck.png" alt="Tariff to Shipper" title="Tariff to Shipper" width="16" height="16"/> <strong>To Carrier: </strong><?= $this->entity->getCarrierPay() ?><br />        <img style="vertical-align: middle" src="<?= SITE_IN ?>images/icons/person.png" alt="Tariff by Customer" title="Tariff by Customer" width="16" height="16"/> <strong>Deposit amount: </strong><?= $this->entity->getTotalDeposit() ?><br />    </div></div><div style="clear:right;"></div><div class="quote-info" style="width:220px;float: right;">	<p class="block-title">Status</p>	<div>		<strong>New quote: </strong><?= $this->entity->getQuoted("m/d/y h:i a") ?>	</div></div><div class="quote-info" style="width:220px;float:right;margin-right: 10px;">	<p class="block-title">Dates</p>	<div>		<strong>Estimated Ship Date: </strong><?= $this->entity->getShipDate("m/d/y") ?>	</div></div><div style="clear:right;"></div><?php $notes = $this->notes; ?><div class="quote-info" style="width: 470px;float: right;margin-top: 10px;">	<p class="block-title">Internal Notes</p>	<div>	<?php if (!$this->entity->readonly) : ?>		<textarea class="form-box-textarea" style="width: 460px; height: 50px;" maxlength="1000" id="internal_note"></textarea>		<div style="float:right;"><?= functionButton('Add Note', 'addInternalNote()') ?></div>		<div style="clear:both;"><br/></div>	<?php endif; ?>		<table cellspacing="0" cellpadding="0" width="100%" border="0" class="grid" id="internal_notes_table">			<thead>			<tr class="grid-head">                <td class="grid-head-left"><?=$this->order->getTitle('created', 'Date')?></td>				<td>Note</td>				<td<?= ($this->entity->readonly)?' class="grid-head-right"':'' ?>>User</td>				<?php if (!$this->entity->readonly) : ?><td class="grid-head-right">Action</td><?php endif; ?>			</tr>			</thead>			<tbody>			<? if (count($notes[Note::TYPE_INTERNAL]) == 0) : ?>			<tr class="grid-body">				<td colspan="4" class="grid-body-right grid-body-left" align="center"><i>No noteas available.</i></td>			</tr>			<? else : ?>			<?php foreach($notes[Note::TYPE_INTERNAL] as $note) : ?>			<?php $sender = $note->getSender(); ?>			<tr class="grid-body">				<td style="white-space:nowrap;" class="grid-body-left"><?= $note->getCreated("m/d/y") ?></td>				<td id="note_<?= $note->id ?>_text"><?= $note->getText() ?></td>				<td style="text-align: center;"<?= ($this->entity->readonly)?' class="grid-body-right"':'' ?>><a href="mailto:<?= $sender->email ?>"><?= $sender->contactname ?></a></td>				<?php if (!$this->entity->readonly) : ?>				<td class="grid-body-right" style="white-space: nowrap;">					<img src="<?= SITE_IN ?>images/icons/edit.png" alt="Edit" title="Edit" width="16" height="16" class="action-icon edit-note" onclick="editInternalNote(<?= $note->id ?>)"/>					<img src="<?= SITE_IN ?>images/icons/delete.png" alt="Delete" title="Delete" width="16" height="16" class="action-icon delete-note" onclick="delInternalNote(<?= $note->id ?>)"/>				</td>				<?php endif; ?>			</tr>			<?php endforeach; ?>			<?php endif ; ?>			</tbody>		</table>	</div></div><div style="clear:left;"></div><div class="quote-info" style="width: 445px;float: left;margin-top: 10px;">	<p class="block-title">Notes from Shipper</p>	<div>		<?php foreach ($notes[Note::TYPE_FROM] as $note) : ?>		<div style="margin-top:5px;border-bottom: 1px solid #CCCCCC;clear:both;">		<?= $note->getText() ?>		</div>		<?php endforeach; ?>	</div></div>    <div class="order-info" style="width: 445px;float: left;margin-top: 10px;">        <p class="block-title">DocumentsDocuments</p>        <div>            <ul class="files-list" id="cat">                <?php if ( isset($this->files) && count($this->files) ) { ?>                    <? foreach ($this->files as $file) { ?>                        <li id="file-<?= $file['id'] ?>">                            <?=$file['img']?>                            <a href="<?=getLink("quotes", "getdocs", "id", $file['id'])?>"><?=$file['name_original']?></a>                            (<?=$file['size_formated']?>)                            &nbsp;&nbsp;<a href="#" onclick="sendFile('<?=$file['id'];?>', '<?=$file['name_original']?>')">Email</a>                            &nbsp;&nbsp;<a <?=strtolower($file['type'])=='pdf'?"target=\"_blank\"":""?> href="<?=getLink("quotes", "getdocs", "id", $file['id'])?>">View</a>                        </li>                    <?php } ?>                <?php } else { ?>                    <li id="nodocs">No documents.</li>                <?php } ?>            </ul>        </div>    </div><div style="clear:both;"></div>